<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Редактирование расписания</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .calendar {
            margin: 20px 0;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        .calendar-day {
            text-align: center;
            padding: 10px;
            border: 1px solid #ddd;
            cursor: pointer;
        }
        .calendar-day:hover {
            background-color: #f0f0f0;
        }
        .calendar-day.has-lesson {
            background-color: #e3f2fd;
        }
        .calendar-day.selected {
            background-color: #2196f3;
            color: white;
        }
        .schedule-form {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2>Редактирование расписания</h2>
        
        <div class="calendar">
            <div class="calendar-header d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-outline-primary" onclick="previousMonth()">&lt;</button>
                <h4 id="currentMonth"></h4>
                <button class="btn btn-outline-primary" onclick="nextMonth()">&gt;</button>
            </div>
            <div class="calendar-grid" id="calendarGrid">
                <!-- Дни недели -->
                <div class="calendar-day">Пн</div>
                <div class="calendar-day">Вт</div>
                <div class="calendar-day">Ср</div>
                <div class="calendar-day">Чт</div>
                <div class="calendar-day">Пт</div>
                <div class="calendar-day">Сб</div>
                <div class="calendar-day">Вс</div>
            </div>
        </div>

        <div class="schedule-form">
            <form id="scheduleForm" method="POST" action="/add_schedule">
                <input type="hidden" name="pair_id" value="{{ pair.id }}">
                <input type="hidden" name="day_of_week" id="selectedDay">
                
                <div class="mb-3">
                    <label for="time" class="form-label">Время</label>
                    <input type="time" class="form-control" id="time" name="time" required>
                </div>
                
                <div class="mb-3">
                    <label for="subject" class="form-label">Предмет</label>
                    <input type="text" class="form-control" id="subject" name="subject" required>
                </div>
                
                <button type="submit" class="btn btn-primary">Сохранить</button>
            </form>
        </div>

        <div class="mt-4">
            <h3>Текущее расписание</h3>
            <div class="list-group">
                {% for schedule in schedules %}
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>
                                    {% if schedule.day == 0 %}Понедельник
                                    {% elif schedule.day == 1 %}Вторник
                                    {% elif schedule.day == 2 %}Среда
                                    {% elif schedule.day == 3 %}Четверг
                                    {% elif schedule.day == 4 %}Пятница
                                    {% elif schedule.day == 5 %}Суббота
                                    {% elif schedule.day == 6 %}Воскресенье
                                    {% endif %}
                                </strong>
                                <br>
                                {{ schedule.time }} - {{ schedule.subject }}
                            </div>
                            <a href="/delete_schedule/{{ schedule.id }}" class="btn btn-danger btn-sm">Удалить</a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let selectedDay = null;

        function updateCalendar() {
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startingDay = firstDay.getDay() || 7;
            const monthLength = lastDay.getDate();

            const monthNames = ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 
                              'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];
            
            document.getElementById('currentMonth').textContent = 
                `${monthNames[currentMonth]} ${currentYear}`;

            const grid = document.getElementById('calendarGrid');
            while (grid.children.length > 7) {
                grid.removeChild(grid.lastChild);
            }

            for (let i = 1; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                grid.appendChild(emptyDay);
            }

            for (let day = 1; day <= monthLength; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;

                const dayOfWeek = (startingDay + day - 2) % 7;
                const hasLesson = {{ schedules|tojson }}.some(s => s.day === dayOfWeek);
                if (hasLesson) {
                    dayElement.classList.add('has-lesson');
                }

                if (day === selectedDay) {
                    dayElement.classList.add('selected');
                }

                dayElement.onclick = () => {
                    document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected'));
                    dayElement.classList.add('selected');
                    selectedDay = day;
                    document.getElementById('selectedDay').value = dayOfWeek;
                };

                grid.appendChild(dayElement);
            }
        }

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            updateCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            updateCalendar();
        }

        updateCalendar();
    </script>
</body>
</html> 